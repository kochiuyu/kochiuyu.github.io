<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.2.4">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Chiu Yu Ko">

  
  
  
    
  
  <meta name="description" content="ProgrammingWe will learn basic programming techniques in R to prepare ourselves to write program:
Conditional statementsIterative StatementsLearning Objective:
Learn how to use relational operators
Learn how to use logical operators
Learn how to use conditional statements (if)
Learn how to use basic iterative statements (do while, for)
Learn how to use advanced iterative statements (apply, Reduce)
Logical statementsA logical variable (or Boolean variable) is either 0 (false) or 1 (true).">

  
  <link rel="alternate" hreflang="en-us" href="/r-programming/ta-with-r-ch5/">

  


  

  

  

  

  

  

  
  
  
  <meta name="theme-color" content="#3f51b5">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.2.0/leaflet.css" integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ==" crossorigin="anonymous">
    

    

  

  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700|Roboto:400,400italic,700|Roboto+Mono">
  

  <link rel="stylesheet" href="/styles.css">
  

  
  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-7442008-8', 'auto');
      
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  
  

  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/r-programming/ta-with-r-ch5/">

  
  
  
  
    
    
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="Chiu Yu Ko">
  <meta property="og:url" content="/r-programming/ta-with-r-ch5/">
  <meta property="og:title" content=" | Chiu Yu Ko">
  <meta property="og:description" content="ProgrammingWe will learn basic programming techniques in R to prepare ourselves to write program:
Conditional statementsIterative StatementsLearning Objective:
Learn how to use relational operators
Learn how to use logical operators
Learn how to use conditional statements (if)
Learn how to use basic iterative statements (do while, for)
Learn how to use advanced iterative statements (apply, Reduce)
Logical statementsA logical variable (or Boolean variable) is either 0 (false) or 1 (true)."><meta property="og:image" content="/img/icon-192.png">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2018-09-09T00:00:00&#43;08:00">
  
  <meta property="article:modified_time" content="2018-09-09T00:00:00&#43;08:00">
  

  

  

  <title> | Chiu Yu Ko</title>

</head>
<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >
  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" role="textbox" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">Chiu Yu Ko</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav mr-auto">
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/files/cv.pdf">
            
            <span>CV</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#featured">
            
            <span>Publication</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#workingpaper">
            
            <span>Working Paper</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#teaching">
            
            <span>Teaching</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/courses/">
            
            <span>Courses</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#book">
            
            <span>Book</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/r-programming/">
            
            <span>R</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/tikz/">
            
            <span>TikZ</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/vba/">
            
            <span>VBA</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/others/">
            
            <span>Others</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        

      
      </ul>
      <ul class="navbar-nav ml-auto">
      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>



<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
  <input name="q" type="search" class="form-control" id="search-query" placeholder="Search..." autocomplete="off">
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/r-programming/">R</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/r-programming/installation/">Overview</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/r-programming/installation/">Installation</a>
      </li>
      
    </ul>
    

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/r-programming/technical-analysis-with-r/">Book</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/r-programming/technical-analysis-with-r/">Technical analysis with R</a>
      </li>
      
      <li >
        <a href="/r-programming/excel-vba-r/">Financial programming with Excel VBA R</a>
      </li>
      
    </ul>
    

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/r-programming/package/">R-Package</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/r-programming/package/">Candle Sticks</a>
      </li>
      
    </ul>
    

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/r-programming/ta-with-r/">Technical Analysis with R</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/r-programming/ta-with-r-ch1/">Chapter 1 Introduction</a>
      </li>
      
      <li >
        <a href="/r-programming/ta-with-r-ch2/">Chapter 2 Working with Data</a>
      </li>
      
      <li >
        <a href="/r-programming/ta-with-r-ch3/">Chapter 3 Plotting</a>
      </li>
      
      <li >
        <a href="/r-programming/ta-with-r-ch4/">Chapter 4 Statistics</a>
      </li>
      
      <li class="active">
        <a href="/r-programming/ta-with-r-ch5/">Chapter 5 Programming</a>
      </li>
      
      <li >
        <a href="/r-programming/ta-with-r-ch6/">Chapter 6 Scrapping</a>
      </li>
      
      <li >
        <a href="/r-programming/ta-with-r-ch7/">Chapter 7 Quantmod</a>
      </li>
      
      <li >
        <a href="/r-programming/ta-with-r-ch8/">Chapter 8 Quanstrat</a>
      </li>
      
    </ul>
    

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/r-programming/"></a>

  </div>
  
  
</nav>

    </div>

    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article" itemscope itemtype="http://schema.org/Article">

        <div class="docs-article-container">
          <h1 itemprop="name"></h1>

          <div class="article-style" itemprop="articleBody">
            


<div id="programming" class="section level1">
<h1>Programming</h1>
<p>We will learn basic programming techniques in R to prepare ourselves to write program:</p>
<ul>
<li>Conditional statements</li>
<li>Iterative Statements</li>
</ul>
<p>Learning Objective:</p>
<ul>
<li><p>Learn how to use relational operators</p></li>
<li><p>Learn how to use logical operators</p></li>
<li><p>Learn how to use conditional statements (<strong>if</strong>)</p></li>
<li><p>Learn how to use basic iterative statements (<strong>do while</strong>, <strong>for</strong>)</p></li>
<li><p>Learn how to use advanced iterative statements (<strong>apply</strong>, <strong>Reduce</strong>)</p></li>
</ul>
<div id="logical-statements" class="section level2">
<h2>Logical statements</h2>
<p>A logical variable (or Boolean variable) is either 0 (false) or 1 (true).</p>
<p>The basic way to define a logical variable is by relational operators by comparing two expressions. For example, we often ask if a variable x is bigger than a certain number?</p>
<p>A more sophiciated way is to combine two simple logical statements using logical operators.</p>
<div id="relational-operators" class="section level3">
<h3>Relational Operators</h3>
<p>It compares two numerical expressions and return a Boolean variable: either 0 (FALSE) or 1 (TRUE). The following table shows the six commonly used relational operators</p>
<table>
<thead>
<tr class="header">
<th>Relational operator</th>
<th>Interpretation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>&lt;</td>
<td>less than</td>
</tr>
<tr class="even">
<td>&lt;=</td>
<td>less than or equal to</td>
</tr>
<tr class="odd">
<td>&gt;</td>
<td>greater than</td>
</tr>
<tr class="even">
<td>&gt;=</td>
<td>greater than or equal to</td>
</tr>
<tr class="odd">
<td>==</td>
<td>equal to</td>
</tr>
<tr class="even">
<td>!=</td>
<td>not equal to</td>
</tr>
</tbody>
</table>
<p>Precedence of relational operators is lower than arithmetic operators. To avoid confusion, it is good practice to use brackets to control ordering. For example, if we write 2 + 2 1 + 3, then the software we do the arithmetic operators first. This implies we have 4 4, which implies a false statement</p>
</div>
<div id="logical-operators" class="section level3">
<h3>Logical Operators</h3>
<p>In practice, we often use two or more conditions to decide what to do. For example, scholarship is often given if the candidate has done well in both academic and extra-curricular activities.</p>
<p>To combine different conditions, there are three logical operators: (1) &amp;&amp;, (2) ||, and (3) !.</p>
<p>First, &amp;&amp; is similar to <strong>AND</strong> in English, that is, A &amp;&amp; B is true only if both A and B are true. Second,  is similar to <strong>OR</strong> in English, that is, A || B is false only if both A and B are false. Third, ! is similar to <strong>NOT</strong> in English, that is, !A is true only if A is false.</p>
<table>
<thead>
<tr class="header">
<th>A</th>
<th>B</th>
<th>A &amp;&amp; B</th>
<th>A || B</th>
<th>!A</th>
<th>!B</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>false</td>
<td>false</td>
<td>false</td>
<td>false</td>
<td>true</td>
<td>true</td>
</tr>
<tr class="even">
<td>false</td>
<td>true</td>
<td>false</td>
<td>true</td>
<td>true</td>
<td>false</td>
</tr>
<tr class="odd">
<td>true</td>
<td>false</td>
<td>false</td>
<td>true</td>
<td>false</td>
<td>true</td>
</tr>
<tr class="even">
<td>true</td>
<td>true</td>
<td>true</td>
<td>true</td>
<td>false</td>
<td>false</td>
</tr>
</tbody>
</table>
<p>Different relational operators, the precedence of logical operators can be high. While <strong>and</strong> and <strong>or</strong> operators are lower in precedence than relational operators, <strong>not</strong> has a very high precedence and almost always evaluated first. - Hence, it is always a good practice to use brackets to control operation ordering.</p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="//www.youtube.com/embed/MIY7rz0XBEA" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

</div>
</div>
<div id="conditional" class="section level2">
<h2>Conditional</h2>
<p>Perform a different set of statement(s) based on whether the condition is true or false.</p>
<pre class="r"><code>if (condition){
  blocks to execute when condition hold
} else{
  blocks to execuse when condition fails
}</code></pre>
<p>Example of if-else statement</p>
<pre class="r"><code>x &lt;- 1
y &lt;- 2
if(x &lt; y){print(&quot;Yes!&quot;)}</code></pre>
<pre><code>## [1] &quot;Yes!&quot;</code></pre>
<pre class="r"><code>if(x&lt;y){
  print(&quot;Yes!&quot;)
} else{
  print(&quot;No~&quot;)
}</code></pre>
<pre><code>## [1] &quot;Yes!&quot;</code></pre>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="//www.youtube.com/embed/Epv7HREx38E" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<div id="exercises" class="section level3 unnumbered">
<h3>Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Write a function f(x) that returns absolute value of x.</p>
<ul>
<li><p>If x is positive, then f(x) =x.</p></li>
<li><p>If x is negative, then f(x) = -x.</p></li>
</ul></li>
<li><p>Write a function f(x) that returns CAP given exam score x.</p>
<ul>
<li><p>If x=90, then CAP is 5.</p></li>
<li><p>If x is between 80 and 90, then CAP is 4.</p></li>
<li><p>If x is between 70 and 80, then CAP is 3.</p></li>
<li><p>If x is less than 70, then CAP is 2.</p></li>
</ul></li>
<li>Write a function f(x,y) that returns grade using test score x and exam score y.
<ul>
<li>If x+y is no less than 90 and y is no less than 40, then grade is A+.</li>
<li>If x+y is no less than 80 but less than 90, then CAP is A.</li>
<li>If x+y is no less than 70 but less than 80, then CAP is A-.</li>
<li>If x+y is less than 70, then CAP is B+.</li>
</ul></li>
</ol>
</div>
<div id="application-checking-data-type" class="section level3">
<h3>Application: Checking Data Type</h3>
<p>One important usage of conditional statement is to check whether the data for calculation is correct.</p>
<p>Very often, we only want to execute the code if the data point exists. We can use <strong>is.na()</strong>. It will return true if it is NA; otherwise false.</p>
<pre class="r"><code>if(!is.na(x)){
  do.something
}</code></pre>
<p>Another related function is to check if the data type is number. The function <strong>is.numeric()</strong> returns true if it is numerical variable; otherwise false.</p>
</div>
<div id="application-missing-data" class="section level3">
<h3>Application: Missing data</h3>
<p>Note that R reports error if there is an NA in the statement.</p>
<pre class="r"><code>x &lt;- NA
x &gt; 0</code></pre>
<pre><code>## [1] NA</code></pre>
<p>Very often, we want to set ignore those case with missing data (NA). Then we will use <strong>isTRUE</strong></p>
<pre class="r"><code>x &lt;- NA
isTRUE(x &gt; 0)</code></pre>
<pre><code>## [1] FALSE</code></pre>
</div>
</div>
<div id="loop" class="section level2">
<h2>Loop</h2>
<p>We very often want to execute codes multiple times with the same or similar conditions. There are two basic forms of repetition statement in R:</p>
<ol style="list-style-type: decimal">
<li>While loop: repeat as long as condition is true,</li>
<li>for loop over integers: repeat for a pre-specific number of times, and</li>
<li>for loop over vector.</li>
</ol>
<div id="while-loop" class="section level3">
<h3>While loop</h3>
<p>The syntax of while loop is as follows:</p>
<pre class="r"><code>while (condition){
  keep doing when condition holds
}</code></pre>
<p>The following example shows how to calculate the sum of all integers from 1 to 10.</p>
<pre class="r"><code>n &lt;- 10
i &lt;- 1
sum &lt;- 0
while (i &lt;= n){         # i is the control variable     
  sum &lt;- sum + i        # accumulate i into sum
        i &lt;- i + 1      # increment i by 1
  }</code></pre>
</div>
<div id="for-loop-over-integers" class="section level3">
<h3>For Loop over integers</h3>
<p>Loops that are based on the value of an integer variable. It increases by the same amount each time, and ends when the variable reaches a specified value</p>
<p>The syntax for a for loop is simple.</p>
<pre class="r"><code>m &lt;- 1
n &lt;-10
for (i in m:n){
  run as long as condition holds
}</code></pre>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="//www.youtube.com/embed/88cOkk8cJcQ" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

</div>
<div id="loop-over-vectors" class="section level3">
<h3>Loop over vectors</h3>
<p>We can define a vector and construct a for loop that executes for each element in the vector:</p>
<pre class="r"><code>students &lt;- c(&quot;Amy&quot;, &quot;Tom&quot;)
for (student in students){
   cat(student,&quot;\n&quot;)
}</code></pre>
<pre><code>## Amy 
## Tom</code></pre>
</div>
<div id="example-technical-indicators" class="section level3">
<h3>Example: Technical Indicators</h3>
<p>A n-day simple moving avaerage (n-day SMA) is arithmetic average of prices of past n days:</p>
<p><span class="math display">\[ SMA_t(n) = \frac{P_t+\ldots+P_{t-n+1}}{n}\]</span></p>
<p>The following is an SMA function:</p>
<pre class="r"><code>mySMA &lt;- function (price,n){
  sma &lt;- c()
  sma[1:(n-1)] &lt;- NA
  for (i in n:length(price)){
    sma[i]&lt;-mean(price[(i-n+1):i])
  }
  return(sma)
}
mySMA(1:10,5)</code></pre>
<pre><code>##  [1] NA NA NA NA  3  4  5  6  7  8</code></pre>
<p>An n-day exponential moving avaerage (n-day EMA) is exponential average of prices where weighting of more recent prices carry higher weights. The first EMA is similar to SMA and the updating formula is simple.</p>
<p><span class="math display">\[ EMA_t(n) = \beta P_t +(1-\beta) EMA_{t-1}(n)\]</span></p>
<p>where <span class="math inline">\(\beta =\frac{2}{n+1}\)</span>, <span class="math inline">\(n\)</span> is number of days and <span class="math inline">\(P_t\)</span> is price of time <span class="math inline">\(t\)</span>.</p>
<p>This is an EMA function:</p>
<pre class="r"><code>myEMA &lt;- function (price,n){
  ema &lt;- c()
  ema[1:(n-1)] &lt;- NA
  ema[n]&lt;- mean(price[1:n])
  beta &lt;- 2/(n+1)
  for (i in (n+1):length(price)){
    ema[i]&lt;-beta * price[i] + 
      (1-beta) * ema[i-1]
  }
  return(ema)
}
myEMA(1:10,5)</code></pre>
<pre><code>##  [1] NA NA NA NA  3  4  5  6  7  8</code></pre>
<p>An n-day relative strenght index (RSI) is normalized n-day relative strength (RS) that is ratio of days of stock price has gone up to the days of stock price have gone down.</p>
<p>This is an RSI function:</p>
<pre class="r"><code>myRSI &lt;- function (price,n){
  U &lt;- rep(0,length(price))
  D &lt;- rep(0,length(price))
  rs &lt;- rep(NA,length(price))
  rsi &lt;- rep(NA,length(price))
  for (i in 2:length(price)){
    if (price[i]&gt;price[(i-1)]){
      U[i] &lt;- 1
    } else if (price[i]&lt;price[(i-1)]){
      D[i] &lt;- 1
    }
    if (i&gt;n){
      if (sum(D[(i-n+1):i])==0){
        rsi[i] &lt;- 100
      } else{
        rs[i] &lt;- sum(U[(i-n+1):i])/
          sum(D[(i-n+1):i])
        rsi[i] &lt;- rs[i]/(rs[i]+1)*100
      }
    }
  }
  return(rsi)
}
myRSI(sample(4:10,20,replace=TRUE),6)</code></pre>
<pre><code>##  [1]       NA       NA       NA       NA       NA       NA 50.00000
##  [8] 40.00000 20.00000 33.33333 33.33333 20.00000 40.00000 60.00000
## [15] 75.00000 50.00000 66.66667 75.00000 50.00000 33.33333</code></pre>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="//www.youtube.com/embed/lxWsc4DcjH8" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

</div>
<div id="exercise" class="section level3 unnumbered">
<h3>Exercise</h3>
<ol style="list-style-type: decimal">
<li><p>Use while loop to calculate the product of all numbers from 50 to 100.</p></li>
<li><p>Use for loop to calculate the product of all numbers from 50 to 100.</p></li>
<li>Write a MACD function that returns both macd and signal line using four inputs:</li>
</ol>
<ul>
<li>price: price vector</li>
<li>S: number of periods for fast moving average</li>
<li>L: number of periods for slow moving average</li>
<li>K: number of periods for signal moving average</li>
</ul>
</div>
</div>
<div id="apply-family" class="section level2">
<h2>Apply Family</h2>
<p><strong>Apply</strong> family is a very convenient tools to loop over data structure (vector, array, matrix and list). The most useful for our purposes are:</p>
<ol style="list-style-type: decimal">
<li><strong>apply()</strong>,</li>
<li><strong>sapply()</strong>, and</li>
<li><strong>lapply()</strong>.</li>
</ol>
<div id="apply" class="section level3">
<h3>apply</h3>
<p>We will to apply a function to each row or each column on a matrix. It will apply a function by-column (=2) or by-row (=1).</p>
<pre class="r"><code>x &lt;- matrix(1:9, nrow = 3, ncol=3)
x</code></pre>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    4    7
## [2,]    2    5    8
## [3,]    3    6    9</code></pre>
<pre class="r"><code>apply(x,1,mean) # average each row</code></pre>
<pre><code>## [1] 4 5 6</code></pre>
<pre class="r"><code>apply(x,2,mean) # average each column</code></pre>
<pre><code>## [1] 2 5 8</code></pre>
</div>
<div id="sapply-and-lapply" class="section level3">
<h3>sapply and lapply</h3>
<p>Sometimes, we will apply a function repeatedly on each element of a vector (or a list). Then sapply is more convenient then a for loop.</p>
<p>Consider the following for loop that returns the square of each element</p>
<pre class="r"><code>x &lt;- c(1,3,5)
for (i in 1:length(x)) {
  x[i] &lt;- x[i]^2
}
x</code></pre>
<pre><code>## [1]  1  9 25</code></pre>
<p>We can do the same using <strong>sapply()</strong> with much cleaner code.</p>
<pre class="r"><code>x &lt;- c(1,3,5)
x &lt;- sapply(x, function(x) x^2)
x</code></pre>
<pre><code>## [1]  1  9 25</code></pre>
<p><strong>lapply()</strong> is the same as <strong>sapply()</strong> but we end up with a list instead of vector. We can use unlist to get back the same result as <strong>sapply()</strong>.</p>
<pre class="r"><code>x &lt;- c(1,3,5)
x &lt;- lapply(x, function(x) x^2)
x</code></pre>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 9
## 
## [[3]]
## [1] 25</code></pre>
<pre class="r"><code>x &lt;- unlist(x)</code></pre>
</div>
</div>
<div id="reduce" class="section level2">
<h2>Reduce</h2>
<p>Sometimes, we want to get a final result by applying operation one by one.</p>
<div id="on-vector" class="section level3">
<h3>On vector</h3>
<p>For example, 2-day moving average is <span class="math display">\[EMA_{t}=\frac{1}{3}p_{t}+\frac{2}{3}EMA_{t-1}\]</span>.</p>
<p>The following example shows the final 2-day EMA with initial EMA being 5.</p>
<pre class="r"><code>price &lt;- 1:10
ema &lt;- 5
for (i in 1:length(price)) {
 ema &lt;- (ema + 2*price[i])/3 
}
ema</code></pre>
<pre><code>## [1] 9.500093</code></pre>
<p>The following example use Reduce to simplify the code.</p>
<pre class="r"><code>price &lt;- 1:10
initial &lt;- 5
ema &lt;- Reduce(function(x,y){(x+2*y)/3},price,initial)
ema</code></pre>
<pre><code>## [1] 9.500093</code></pre>
</div>
<div id="on-list" class="section level3">
<h3>On list</h3>
<p>The following example shows how we can combine data sets.</p>
<pre class="r"><code>HI &lt;- data.frame(stock=c(1,2), high=c(7,8))
LO &lt;- data.frame(stock=c(1,2), low=c(1,2))
OP &lt;- data.frame(stock=c(1,2), open=c(3,6))
CL &lt;- data.frame(stock=c(1,2), close=c(5,5))
df &lt;-merge(HI,LO)
df &lt;-merge(df,OP)
df &lt;-merge(df,CL)
df</code></pre>
<pre><code>##   stock high low open close
## 1     1    7   1    3     5
## 2     2    8   2    6     5</code></pre>
<p>Since merging is one by one on the data.frame, we just need to create a list of data.frame.</p>
<pre class="r"><code>HI &lt;- data.frame(stock=c(1,2), high=c(7,8))
LO &lt;- data.frame(stock=c(1,2), low=c(1,2))
OP &lt;- data.frame(stock=c(1,2), open=c(3,6))
CL &lt;- data.frame(stock=c(1,2), close=c(5,5))
df &lt;- Reduce(function(x,y) {merge(x,y)}, list(HI, LO, OP, CL))
df</code></pre>
<pre><code>##   stock high low open close
## 1     1    7   1    3     5
## 2     2    8   2    6     5</code></pre>
</div>
</div>
<div id="tricks" class="section level2">
<h2>Tricks</h2>
<p>There are some minor tricks to help you in coding. For long codes, we sometimes want to calculate the time required to complete a task, and we might improve the efficiency of the code if it is too slow.</p>
<div id="timing-code" class="section level3">
<h3>Timing code</h3>
<p>To get the current time, we may use <strong>Sys.time()</strong>. Put this at the beginning and the end of the code. Then the difference is the run time.</p>
<pre class="r"><code>t1 &lt;- sys.time()
#…run code here …#
t2 &lt;- sys.time()
t2-t1</code></pre>
</div>
<div id="suppress-annoying-message" class="section level3">
<h3>Suppress annoying message</h3>
<p>R tends to give a lot of warning and messages when you run a long code. Sometimes you want to suppress them to keep your console window clean.</p>
<pre class="r"><code>suppressMessage(…)
suppressWarnings(…)</code></pre>
</div>
<div id="all-files-names-in-a-folder" class="section level3">
<h3>All files names in a folder</h3>
<p>The function list.files will find all files in a folder.</p>
<pre class="r"><code># full.names = TRUE for full path
filenames &lt;- list.files(path = &quot;./folder/&quot;, full.names = TRUE)</code></pre>
<p>Using <strong>Reduce()</strong> and <strong>lapply()</strong> we can read all csv files from the folder, and merge them together</p>
<pre class="r"><code>setwd(&quot;C:/path&quot;)
file.names &lt;-list.files(path = &quot;.&quot;, 
                        pattern=&quot;*.csv&quot;,
                        full.names = TRUE)
file.list &lt;- lapply(file.names, 
                    function(x){
                      read.csv(file = x,
                               header = TRUE,
                               stringsAsFactors = FALSE)})
df&lt;-Reduce(function(x,y) {merge(x, y, all=TRUE)},
           file.list)</code></pre>
</div>
</div>
</div>

          </div>

          

        </div>

        <div class="body-footer">
          Last updated on Sep 9, 2018
        </div>

      </article>

      <footer class="site-footer">
  
  <p class="powered-by">
    <a href="/privacy/">Privacy Policy</a>
  </p>
  

  <p class="powered-by">
    2019 &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
  </p>
</footer>


    </main>
  </div>
</div>

    

    
    
    
    <script src="/js/mathjax-config.js"></script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha512-+NqPlbbtM1QqiK8ZAo4Yrj2c4lNQoGv8P79DPtKzj++l5jnN39rHA/xsqn8zE9l0uSoxaCdrOgFs6yjyfbBxSg==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
        
      

      
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous" async></script>
      
    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.2.0/leaflet.js" integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log==" crossorigin="anonymous"></script>
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.b82789348bc9b927834992b317787f39.js"></script>

  </body>
</html>


